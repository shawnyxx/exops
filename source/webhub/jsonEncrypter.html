<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Encrypter</title>
    <style>
        :root { --primary-color: #4361ee; --secondary-color: #3f37c9; --background-color: #f8f9fa; --card-color: #ffffff; --text-color: #212529; --error-color: #e63946; --success-color: #2a9d8f; --border-radius: 8px; --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); --transition: all 0.3s ease; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html, body { height: 100%; overflow: hidden; }
        body { background-color: var(--background-color); color: var(--text-color); line-height: 1.5; padding: 10px; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .container { background-color: var(--card-color); border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding: 15px; width: 98%; max-width: 900px; height: 98vh; display: flex; flex-direction: column; }
        h1 { text-align: center; margin-bottom: 10px; color: var(--primary-color); font-size: 24px; }
        .info-banner { background-color: rgba(67, 97, 238, 0.1); border-left: 4px solid var(--primary-color); padding: 6px 10px; margin-bottom: 10px; border-radius: 4px; font-size: 14px; }
        .info-icon { margin-right: 8px; font-size: 16px; }
        .form-group { margin-bottom: 10px; }
        label { display: block; font-weight: 600; margin-bottom: 4px; font-size: 14px; }
        textarea, input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: var(--border-radius); font-size: 14px; transition: var(--transition); }
        textarea { height: 110px; resize: none; }
        textarea:focus, input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1); }
        .button-group { display: flex; gap: 8px; margin-bottom: 10px; }
        button { background-color: var(--primary-color); color: white; border: none; padding: 8px 16px; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; transition: var(--transition); flex: 1; font-size: 13px; }
        button:hover { background-color: var(--secondary-color); transform: translateY(-1px); }
        button.secondary { background-color: #6c757d; }
        button.secondary:hover { background-color: #5a6268; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .alert { padding: 8px; border-radius: var(--border-radius); margin-bottom: 10px; display: none; font-size: 14px; }
        .alert-error { background-color: rgba(230, 57, 70, 0.1); color: var(--error-color); border: 1px solid rgba(230, 57, 70, 0.3); }
        .alert-success { background-color: rgba(42, 157, 143, 0.1); color: var(--success-color); border: 1px solid rgba(42, 157, 143, 0.3); }
        .copy-btn { display: inline-block; padding: 4px 10px; background-color: #eee; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; margin-top: 3px; margin-right: 5px; }
        .copy-btn:hover { background-color: #ddd; }
        .tabs { display: flex; margin-bottom: 10px; border-bottom: 1px solid #ddd; }
        .tab { padding: 6px 15px; cursor: pointer; border-bottom: 3px solid transparent; transition: var(--transition); font-size: 14px; }
        .tab.active { border-color: var(--primary-color); font-weight: 600; }
        .tab:hover:not(.active) { background-color: rgba(67, 97, 238, 0.05); }
        .tooltip { cursor: help; position: relative; }
        .key-input-container { display: flex; }
        .toggle-password { flex: 0 0 60px; margin-left: 8px; background: #eee; color: #333; }
        .toggle-password:hover { background: #ddd; transform: none; }
        .key-strength { margin-top: 4px; font-size: 12px; }
        .strength-bar { height: 6px; background-color: #eee; border-radius: 4px; margin-bottom: 2px; overflow: hidden; }
        .strength-level { height: 100%; border-radius: 4px; }
        .weak { background-color: #e63946; }
        .medium { background-color: #f4a261; }
        .good { background-color: #2a9d8f; }
        .strong { background-color: #218838; }
        .button-group button { display: flex; align-items: center; justify-content: center; }
        .button-group button:before { margin-right: 6px; }
        #encryptBtn:before { content: "🔒"; }
        #decryptBtn:before { content: "🔓"; }
        .content-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .dual-column { display: flex; gap: 10px; flex: 1; }
        .column { flex: 1; display: flex; flex-direction: column; }
        .form-actions { display: flex; gap: 5px; }
        @media (max-width: 768px) { .dual-column { flex-direction: column; } }
    </style>
    <script>
        function padKey(keyString) {
            const encoder = new TextEncoder();
            const keyBytes = encoder.encode(keyString);
            const paddedKey = new Uint8Array(16);
            paddedKey.set(keyBytes.slice(0, 16));
            return paddedKey;
        }

        async function encryptJson() {
            try {
                // Show loading state
                const encryptBtn = document.getElementById('encryptBtn');
                const originalText = encryptBtn.textContent;
                encryptBtn.textContent = 'Encrypting...';
                encryptBtn.disabled = true;

                const alertBox = document.getElementById('alert');
                const jsonString = document.getElementById('jsonInput').value;
                const keyString = document.getElementById('keyInput').value;

                if (!jsonString || !keyString) {
                    showAlert('Please provide both JSON data and an encryption key', 'error');
                    encryptBtn.textContent = originalText;
                    encryptBtn.disabled = false;
                    return;
                }

                // Validate JSON
                try {
                    JSON.parse(jsonString);
                } catch (e) {
                    showAlert('Invalid JSON format: ' + e.message, 'error');
                    encryptBtn.textContent = originalText;
                    encryptBtn.disabled = false;
                    return;
                }

                const key = await crypto.subtle.importKey(
                    'raw',
                    padKey(keyString),
                    { name: 'AES-GCM' },
                    false,
                    ['encrypt']
                );

                const iv = crypto.getRandomValues(new Uint8Array(12));
                const encrypted = await crypto.subtle.encrypt(
                    { name: 'AES-GCM', iv: iv },
                    key,
                    new TextEncoder().encode(jsonString)
                );

                const result = JSON.stringify({
                    iv: Array.from(iv),
                    data: Array.from(new Uint8Array(encrypted))
                }, null, 2);

                document.getElementById('output').value = result;
                showAlert('JSON encrypted successfully!', 'success');

                // Reset button state
                encryptBtn.textContent = originalText;
                encryptBtn.disabled = false;
            } catch (error) {
                // Reset button state on error too
                document.getElementById('encryptBtn').textContent = 'Encrypt JSON';
                document.getElementById('encryptBtn').disabled = false;

                showAlert('Encryption error: ' + error.message, 'error');
                console.error(error);
            }
        }

        async function decryptJson() {
            try {
                // Show loading state
                const decryptBtn = document.getElementById('decryptBtn');
                const originalText = decryptBtn.textContent;
                decryptBtn.textContent = 'Decrypting...';
                decryptBtn.disabled = true;

                const encryptedString = document.getElementById('output').value;
                const keyString = document.getElementById('keyInput').value;

                if (!encryptedString || !keyString) {
                    showAlert('Please provide both encrypted data and the correct decryption key', 'error');
                    decryptBtn.textContent = originalText;
                    decryptBtn.disabled = false;
                    return;
                }

                // Validate encrypted data format
                let encryptedData;
                try {
                    encryptedData = JSON.parse(encryptedString);
                    if (!encryptedData.iv || !encryptedData.data) {
                        throw new Error('Invalid encrypted data format');
                    }
                } catch (e) {
                    showAlert('Invalid encrypted data format: ' + e.message, 'error');
                    decryptBtn.textContent = originalText;
                    decryptBtn.disabled = false;
                    return;
                }

                const key = await crypto.subtle.importKey(
                    'raw',
                    padKey(keyString),
                    { name: 'AES-GCM' },
                    false,
                    ['decrypt']
                );

                const iv = new Uint8Array(encryptedData.iv);
                const encrypted = new Uint8Array(encryptedData.data);

                const decrypted = await crypto.subtle.decrypt(
                    { name: 'AES-GCM', iv: iv },
                    key,
                    encrypted
                );

                const decryptedText = new TextDecoder().decode(decrypted);

                // Validate and format JSON
                try {
                    const jsonObj = JSON.parse(decryptedText);
                    document.getElementById('jsonInput').value = JSON.stringify(jsonObj, null, 2);
                } catch (e) {
                    document.getElementById('jsonInput').value = decryptedText;
                }

                showAlert('JSON decrypted successfully!', 'success');

                // Reset button state
                decryptBtn.textContent = originalText;
                decryptBtn.disabled = false;
            } catch (error) {
                // Reset button state on error
                decryptBtn.textContent = 'Decrypt JSON';
                decryptBtn.disabled = false;

                showAlert('Decryption error: ' + error.message, 'error');
                console.error(error);
            }
        }

        function showAlert(message, type) {
            const alertBox = document.getElementById('alert');
            alertBox.textContent = message;
            alertBox.style.display = 'block';

            if (type === 'error') {
                alertBox.className = 'alert alert-error';
            } else {
                alertBox.className = 'alert alert-success';
            }

            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            element.select();
            document.execCommand('copy');

            const copyBtn = document.querySelector(`button[onclick="copyToClipboard('${elementId}')"]`);
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'Copied!';

            setTimeout(() => {
                copyBtn.textContent = originalText;
            }, 2000);
        }

        function formatJson() {
            try {
                const jsonInput = document.getElementById('jsonInput');
                const json = JSON.parse(jsonInput.value);
                jsonInput.value = JSON.stringify(json, null, 2);
                showAlert('JSON formatted successfully!', 'success');
            } catch (error) {
                showAlert('Invalid JSON format: ' + error.message, 'error');
            }
        }

        function clearFields() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('output').value = '';
            document.getElementById('alert').style.display = 'none';
        }

        function switchTab(tabId) {
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            document.getElementById(tabId).classList.add('active');

            if (tabId === 'encryptTab') {
                document.getElementById('encryptBtn').style.display = 'block';
                document.getElementById('decryptBtn').style.display = 'none';
            } else {
                document.getElementById('encryptBtn').style.display = 'none';
                document.getElementById('decryptBtn').style.display = 'block';
            }
        }

        function togglePasswordVisibility() {
            const keyInput = document.getElementById('keyInput');
            const toggleBtn = document.querySelector('.toggle-password');
            if (keyInput.type === 'password') {
                keyInput.type = 'text';
                toggleBtn.textContent = 'Hide';
            } else {
                keyInput.type = 'password';
                toggleBtn.textContent = 'Show';
            }
        }

        function checkKeyStrength() {
            const key = document.getElementById('keyInput').value;
            const strengthIndicator = document.getElementById('keyStrength');

            if (!key) {
                strengthIndicator.innerHTML = '';
                return;
            }

            let strength = 0;
            if (key.length >= 8) strength += 25;
            if (key.match(/[A-Z]/)) strength += 25;
            if (key.match(/[0-9]/)) strength += 25;
            if (key.match(/[^A-Za-z0-9]/)) strength += 25;

            let strengthClass = '';
            let strengthText = '';

            if (strength <= 25) {
                strengthClass = 'weak';
                strengthText = 'Weak';
            } else if (strength <= 50) {
                strengthClass = 'medium';
                strengthText = 'Medium';
            } else if (strength <= 75) {
                strengthClass = 'good';
                strengthText = 'Good';
            } else {
                strengthClass = 'strong';
                strengthText = 'Strong';
            }

            strengthIndicator.innerHTML = `<div class="strength-bar"><div class="strength-level ${strengthClass}" style="width:${strength}%"></div></div><span>${strengthText}</span>`;
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('keyInput').addEventListener('input', checkKeyStrength);
        });
    </script>
</head>

<body>
    <div class="container">
        <h1>JSON Encrypter</h1>

        <div class="info-banner">
            <p><i class="info-icon">ℹ️</i> Securely encrypt your JSON data with AES-GCM encryption. Keep your encryption
                key safe to decrypt later.</p>
        </div>

        <div class="tabs">
            <div id="encryptTab" class="tab active" onclick="switchTab('encryptTab')">Encrypt</div>
            <div id="decryptTab" class="tab" onclick="switchTab('decryptTab')">Decrypt</div>
        </div>

        <div id="alert" class="alert"></div>

        <div class="content-area">
            <div class="dual-column">
                <div class="column">
                    <div class="form-group">
                        <label for="jsonInput">JSON Data:</label>
                        <textarea id="jsonInput" placeholder="Enter your JSON data here"></textarea>
                        <div class="form-actions">
                            <button class="copy-btn" onclick="copyToClipboard('jsonInput')">Copy</button>
                            <button class="copy-btn" onclick="formatJson()">Format JSON</button>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="form-group">
                        <label for="output">Result:</label>
                        <textarea id="output" placeholder="Encrypted/Decrypted output will appear here" readonly></textarea>
                        <button class="copy-btn" onclick="copyToClipboard('output')">Copy</button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="keyInput">Encryption Key: <span class="tooltip"
                        title="This key is used to encrypt and decrypt your data. Keep it safe!">ℹ️</span></label>
                <div class="key-input-container">
                    <input type="password" id="keyInput" placeholder="Enter your encryption key">
                    <button class="toggle-password" onclick="togglePasswordVisibility()">Show</button>
                </div>
                <div class="key-strength" id="keyStrength"></div>
            </div>

            <div class="button-group">
                <button id="encryptBtn" onclick="encryptJson()">Encrypt JSON</button>
                <button id="decryptBtn" onclick="decryptJson()" style="display: none;">Decrypt JSON</button>
                <button class="secondary" onclick="clearFields()">Clear All</button>
            </div>
        </div>
    </div>
</body>

</html>